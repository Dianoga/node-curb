{"version":3,"sources":["../src/curb.js"],"names":[],"mappings":";;;;;;;;;AAAA;;;;AACA;;;;;;AAEA,OAAO,eAAP,GAAyB,QAAQ,mBAAR,CAAzB;;IAEa,I,WAAA,I;AACZ,eAAY,QAAZ,EAAsB,YAAtB,EAAoC;AAAA;;AACnC,OAAK,SAAL,GAAiB,QAAjB;AACA,OAAK,aAAL,GAAqB,YAArB;;AAEA,OAAK,WAAL,GAAmB,4BAAnB;AACA,OAAK,SAAL,GAAiB,eAAjB;AACA,OAAK,WAAL,GAAmB,IAAnB;AACA,OAAK,YAAL,GAAoB,IAApB;;AAEA,OAAK,QAAL,GAAgB,EAAhB;;AAEA,OAAK,GAAL,GAAW,gBAAM,MAAN,CAAa;AACvB,YAAS,KAAK;AADS,GAAb,CAAX;AAGA;;;;uBAEI,Q,EAAU,Q,EAAU;AAAA;;AACxB,OAAM,OAAO,IAAI,eAAJ,EAAb;AACA,QAAK,MAAL,CAAY,YAAZ,EAA0B,UAA1B;AACA,QAAK,MAAL,CAAY,UAAZ,EAAwB,QAAxB;AACA,QAAK,MAAL,CAAY,UAAZ,EAAwB,QAAxB;;AAEA,WAAQ,GAAR,CAAY,uBAAZ;AACA,UAAO,KAAK,GAAL,CAAS,IAAT,CAAc,KAAK,SAAnB,EAA8B,IAA9B,EAAoC;AAC1C,UAAM;AACL,eAAU,KAAK,SADV;AAEL,eAAU,KAAK;AAFV;AADoC,IAApC,EAKJ,IALI,CAKC,gBAAQ;AACf,QAAM,QAAQ,IAAI,MAAJ,CAAW,KAAK,IAAL,CAAU,YAArB,EAAmC,QAAnC,CAA4C,QAA5C,CAAd;AACA,UAAK,GAAL,CAAS,QAAT,CAAkB,OAAlB,CAA0B,MAA1B,CAAiC,eAAjC,gBAA8D,KAA9D;;AAEA,WAAO,MAAK,UAAL,EAAP;AACA,IAVM,EAUJ,IAVI,CAUC,YAAM;AACb,WAAO,MAAK,SAAL,EAAP;AACA,IAZM,CAAP;AAaA;;;+BAEY;AAAA;;AACZ,WAAQ,GAAR,CAAY,uBAAZ;AACA,UAAO,KAAK,GAAL,CAAS,GAAT,CAAa,MAAb,EACL,IADK,CACA,UAAC,IAAD,EAAU;AACf,WAAK,WAAL,GAAmB,KAAK,IAAL,CAAU,MAAV,CAAiB,OAAjB,CAAyB,IAA5C;AACA,WAAK,YAAL,GAAoB,KAAK,IAAL,CAAU,MAAV,CAAiB,QAAjB,CAA0B,IAA9C;AACA,IAJK,CAAP;AAKA;;;8BAEW;AAAA;;AACX,WAAQ,GAAR,CAAY,0BAAZ;AACA,UAAO,KAAK,GAAL,CAAS,GAAT,CAAa,KAAK,YAAlB,EACL,IADK,CACA,gBAAQ;AACb,YAAQ,GAAR,CAAY,6BAAZ;AACA,QAAM,WAAW,KAAK,IAAL,CAAU,SAAV,CAAoB,QAArC;AACA,aAAS,OAAT,CAAiB,eAAO;AACvB,YAAK,QAAL,CAAc,IAAd,CAAmB,kBAAgB,GAAhB,CAAnB;AACA,KAFD;;AAIA,WAAO,OAAK,QAAZ;AACA,IATK,CAAP;AAUA","file":"curb.js","sourcesContent":["import axios from 'axios';\nimport { CurbProfile } from './';\n\nglobal.URLSearchParams = require('url-search-params');\n\nexport class Curb {\n\tconstructor(clientId, clientSecret) {\n\t\tthis._clientId = clientId;\n\t\tthis._clientSecret = clientSecret;\n\n\t\tthis._curbApiUrl = 'https://app.energycurb.com';\n\t\tthis._tokenUrl = '/oauth2/token';\n\t\tthis._devicesUrl = null;\n\t\tthis._profilesUrl = null;\n\n\t\tthis.profiles = [];\n\n\t\tthis.api = axios.create({\n\t\t\tbaseURL: this._curbApiUrl\n\t\t});\n\t}\n\n\tinit(username, password) {\n\t\tconst data = new URLSearchParams();\n\t\tdata.append('grant_type', 'password');\n\t\tdata.append('username', username);\n\t\tdata.append('password', password);\n\n\t\tconsole.log(\"Getting access tokens\");\n\t\treturn this.api.post(this._tokenUrl, data, {\n\t\t\tauth: {\n\t\t\t\tusername: this._clientId,\n\t\t\t\tpassword: this._clientSecret\n\t\t\t}\n\t\t}).then(resp => {\n\t\t\tconst token = new Buffer(resp.data.access_token).toString('base64');\n\t\t\tthis.api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n\n\t\t\treturn this._endpoints();\n\t\t}).then(() => {\n\t\t\treturn this._profiles();\n\t\t});\n\t}\n\n\t_endpoints() {\n\t\tconsole.log(\"Getting API endpoints\");\n\t\treturn this.api.get('/api')\n\t\t\t.then((resp) => {\n\t\t\t\tthis._devicesUrl = resp.data._links.devices.href;\n\t\t\t\tthis._profilesUrl = resp.data._links.profiles.href;\n\t\t\t});\n\t}\n\n\t_profiles() {\n\t\tconsole.log(\"Getting user information\");\n\t\treturn this.api.get(this._profilesUrl)\n\t\t\t.then(resp => {\n\t\t\t\tconsole.log(\"Processing user information\");\n\t\t\t\tconst profiles = resp.data._embedded.profiles;\n\t\t\t\tprofiles.forEach(val => {\n\t\t\t\t\tthis.profiles.push(new CurbProfile(val));\n\t\t\t\t});\n\n\t\t\t\treturn this.profiles;\n\t\t\t});\n\t}\n}\n"]}